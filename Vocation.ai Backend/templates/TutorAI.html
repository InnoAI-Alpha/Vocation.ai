<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="static/vocational (1).png">
    <title>Vocation.ai - Tutor AI</title>
    <link rel="stylesheet" href="https://unpkg.com/intro.js/minified/introjs.min.css">
    <script src="https://unpkg.com/intro.js/minified/intro.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/all.min.js"></script>
    <script src="https://code.responsivevoice.org/responsivevoice.js?key=YOUR_API_KEY"></script>
    <script>
        function isMobile() {
            return /Mobi|Android/i.test(navigator.userAgent);
        }

        if (isMobile()) {
            window.location.href = "mobile.html";
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');
    
        :root {
            --primary-color: #830c4f;
            --secondary-color: #f39c12;
            --text-color: #333;
            --bg-color: #f4f4f4;
            --sidebar-bg: #830c4f;
            --sidebar-hover: #830c4f;
        }
    
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        .highlight {
            padding: 20px;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            margin: 20px;
        }

        .introjs-bullets ul li a.active {
            background: var(--primary-color) !important;
            box-shadow: 0 0 0 2px rgba(131, 12, 79, 0.3);
        }

        .introjs-bullets a {
            background: #9f9b9b !important;
            transition: background 0.3s ease;
        }

        .introjs-tooltip {
            background-color: #f2e1eb;
            border: 2px solid #830c4f;
            border-radius: 12px;
            color: #830c4f;
            font-size: 18px;
            text-align: center;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(131, 12, 79, 0.1);
            padding: 25px;
            max-width: 350px;
        }

        .introjs-tooltiptext {
            margin-bottom: 0;
            line-height: 1.6;
        }

        .introjs-tooltip h3 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #830c4f;
        }

        .introjs-tooltip p {
            margin-bottom: 15px;
        }

        .introjs-button {
            background-color: #830c4f;
            color: #fff;
            text-shadow: none;
            border-radius: 25px;
            transition: all 0.3s ease;
            font-weight: 600;
            padding: 10px 20px;
            text-transform: uppercase;
            font-size: 14px;
            border: 2px solid #830c4f;
            margin: 5px;
        }

        .introjs-skipbutton {
            color: #830c4f;
            background-color: transparent;
            border: 2px solid #830c4f;
        }

        .introjs-button:hover {
            background-color: #f2e1eb;
            color: #830c4f;
            border: 2px solid #830c4f;
            box-shadow: 0 2px 8px rgba(131, 12, 79, 0.2);
        }

        .introjs-button:focus {
            background-color: #f2e1eb;
            border: 2px solid #830c4f;
            color: #830c4f;
            box-shadow: 0 2px 8px rgba(131, 12, 79, 0.2);
        }

        .introjs-skipbutton:hover {
            background-color: #830c4f;
            color: #fff;
        }

        .introjs-tooltip .introjs-skipbutton {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 30px;
            height: 30px;
            padding: 0;
            border-radius: 50%;
            font-size: 18px;
            line-height: 26px;
            text-align: center;
            border: 2px solid #830c4f;
            background-color: transparent;
            color: #830c4f;
            transition: all 0.3s ease;
        }

        .introjs-tooltip .introjs-skipbutton:hover {
            background-color: #830c4f;
            color: #fff;
            transform: rotate(90deg);
        }

        .introjs-arrow {
            border-color: #830c4f;
        }

        .introjs-floating {
            border: 2px solid #830c4f;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(131, 12, 79, 0.1);
        }
    
        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
    
        .chat-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
    
        .sidebar {
            width: 300px;
            background-color: var(--sidebar-bg);
            color: white;
            padding: 20px;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            transition: all 0.3s ease;
        }
    
        .logo {
            font-weight: bold;
            margin-bottom: 25px;
        }
    
        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }
    
        .action-button {
            background-color: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            font-weight: 600;
        }
    
        .action-button:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            background-color: rgba(255, 255, 255, 0.3);
        }
    
        .action-button i {
            margin-right: 15px;
            width: 20px;
            text-align: center;
            font-size: 1.2em;
        }
    
        .chat-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: white;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        }
    
        .chat-header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
    
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            background-color: #f2e1eb;
        }
    
        .message {
            max-width: 70%;
            padding: 12px 18px;
            border-radius: 18px;
            line-height: 1.4;
            display: flex;
            flex-direction: column;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
    
        .user-message { 
            align-self: flex-end;
            background-color: #ea4fa9;
            border-bottom-right-radius: 4px;
            color: white;
        }
    
        .ai-message {
            align-self: flex-start;
            background-color: #ffffff;
            border-bottom-left-radius: 4px;
        }
    
        .ai-message-content {
            display: flex;
            align-items: center;
        }
    
        .sound-icon-wrapper {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 30px;
            height: 30px;
            cursor: pointer;
            border-radius: 50%;
            margin-left: 10px;
            transition: all 0.3s ease;
            color: #830c4f;
        }
    
        .sound-icon {
            color: white;
            font-size: 1em;
        }
    
        .chat-input {
            display: flex;
            padding: 20px;
            background-color: white;
            border-top: 1px solid #e0e0e0;
        }
    
        .chat-input input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 25px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
    
        .chat-input input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(131, 12, 79, 0.1);
        }

        #videoContainer {
            width: 100%;
            border-radius: 8px;
            overflow: hidden;
        }

        #video {
            width: 100%;
            border-radius: 8px;
            display: block;
        }

        #emotion1, #emotion2 {
            font-size: 16px;
            font-weight: bold;
            color: #830c4f;
            margin-top: 10px;
        }
    
        .chat-input button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: 10px;
        }
    
        .chat-input button:hover {
            background-color: #6b0a40;
        }
    
        .mic-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px;
            margin-left: 10px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
        }
    
        .mic-button:hover {
            background-color: #6b0a40;
        }
    
        .file-upload {
            display: none;
        }
    
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: 18px;
            height: 60px;
            margin-bottom: 10px;
        }
    
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
    
        .sidebar-section {
            background-color: rgba(255, 255, 255);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s ease;
        }
    
        .sidebar-section:hover {
            transform: translateY(-3px);
        }
    
        .sidebar-section h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .sidebar-section1 {
            background-color: rgba(255, 255, 255);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
    
        .sidebar-section1:hover {
            transform: translateY(-3px);
        }
    
        .sidebar-section1 h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
    
        .sidebar-list {
            list-style-type: none;
        }
    
        .sidebar-list li {
            margin-bottom: 8px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            color: #333;
            cursor: pointer;
        }
    
        .language-menu {
            position: relative;
            display: inline-block;
        }
    
        .language-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
    
        .language-options {
            display: none;
            position: absolute;
            background-color: white;
            min-width: 120px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
            right: 0;
            border-radius: 8px;
            overflow: hidden;
        }
    
        .ai-switch {
            position: relative;
            display: inline-block;
            cursor: pointer;
            transition: all 0.3s ease;
        }
    
        .ai-switch:hover {
            transform: translateY(-2px);
        }
    
        .ai-options a:hover {
            background-color: #f1f1f1;
            color: var(--primary-color);
        }

        .ai-options {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
            border-radius: 8px;
            overflow: hidden;
        }
    
        .ai-options a {
            color: var(--text-color);
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            transition: all 0.3s ease;
        }
    
        .show {
            display: block;
        }
    
        .ai-switch.active::after {
            transform: rotate(180deg);
        }
    
        @keyframes fadeInOut {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.1; }
        }
    
        .ai-switch-icon {
            animation: fadeInOut 2s infinite;
        }
    
        .ai-switch.active .ai-switch-icon {
            animation: none;
        }
    
        .language-options a {
            color: var(--text-color);
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            transition: all 0.3s ease;
        }
    
        .language-options a:hover {
            background-color: #f1f1f1;
            color: var(--primary-color);
        }

        .progress-box {
            background-color: rgba(255, 255, 255);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .progress-box:hover {
            transform: translateY(-3px);
        }

        .progress-box h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }
    
        .progress-bar {
            background-color: #e0e0e0;
            border-radius: 10px;
            height: 10px;
            margin-top: 5px;
            overflow: hidden;
        }
    
        .progress {
            background: linear-gradient(90deg, var(--primary-color), #b30c6f);
            height: 100%;
            border-radius: 10px;
            width: 0;
            transition: width 0.5s ease-in-out;
        }
    
        .references {
            margin-top: 10px;
            font-size: 0.9rem;
            color: #666;
        }
    
        .references a {
            color: var(--primary-color);
            text-decoration: none;
            transition: all 0.3s ease;
        }
    
        .references a:hover {
            text-decoration: underline;
        }
    
        .references ul {
            list-style-type: none;
            padding-left: 0;
        }
    
        .references li {
            margin-bottom: 5px;
            transition: all 0.3s ease;
        }
    
        .memory-box {
            background-color: #ffffff;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 4px 6px rgba(131, 12, 79, 0.1);
            transition: all 0.3s ease;
        }

        .memory-box h2 {
            color: #830c4f;
            margin-bottom: 15px;
            font-size: 1.4rem;
            border-bottom: 2px solid #830c4f;
            padding-bottom: 10px;
        }

        .memory-box ul {
            list-style-type: none;
            padding-left: 0;
        }

        .memory-box li {
            margin-bottom: 15px;
            background-color: #fff;
            border: 1px solid #830c4f;
            border-radius: 8px;
            padding: 10px;
            transition: all 0.2s ease;
        }

        .memory-box li:hover {
            background-color: rgba(131, 12, 79, 0.05);
        }

        .memory-box li strong {
            color: #830c4f;
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .memory-box li span {
            color: #333;
            display: block;
        }

        .memory-icon {
            color: #830c4f;
            margin-right: 5px;
        }


    </style>
</head>
<body>
    <div class="chat-container">
        <aside class="sidebar">
            <div class="logo"><a href="https://vocation-ai.web.app"><img src="static/Vocation.ai Logo (Horizontal cropped).png" style="height: 65px;"></a></div>
            <div class="action-buttons">
                <button data-intro="Share your screen to utilize TutorAI's vision capabilities while you learn a skill or solve a question, allowing it to guide you effectively." data-step="3" class="action-button" id="shareScreenBtn">
                    <i class="fas fa-desktop"></i> <span style="margin-left: 10px;">Share Screen</span>
                </button>
                <button data-intro="You can upload any document here, such as an image of your homework. TutorAI will then teach and guide you accordingly. It can autograde your homework and determine if you have understood the concept well enough." data-step="4" class="action-button" id="uploadFileBtn">
                    <i class="fas fa-file-upload"></i> <span style="margin-left: 10px;">Upload File</span>
                </button>
                <input type="file" id="fileUpload" class="file-upload" multiple>
                <button data-intro="Open your webcam to allow TutorAI to recognize your facial expressions for better guidance." data-step="5" class="action-button" id="toggleCameraBtn">
                    <i class="fas fa-video"></i> <span style="margin-left: 10px;">Start Camera</span>
                </button>
                <div class="sidebar-section" id="videoContainer" style="display: none;">
                    <video id="video" class="sidebar-section" autoplay></video>
                    <div id="emotion1" style="font-size: 16px; font-weight: bold;">Emotion 1: None</div>
                    <div id="emotion2" style="font-size: 16px; font-weight: bold;">Emotion 2: None</div>
                </div>
                
            </div>
            <div data-intro="Your uploaded files will appear here." data-step="6" class="sidebar-section">
                <h3 style="cursor: pointer;">Uploaded Files</h3>
                <p style="font-size: small; cursor: pointer; color: #333;" id="noou">No Files Uploaded</p>
                <ul class="sidebar-list" id="fileList" style="font-size: 13px;"></ul>
            </div>
            <div data-intro="TutorAI stores information about you to personalize and enhance your study experience. Additionally, TutorAI uses this information to guide your career development and sometimes serves as a mental health counsellor." data-step="7" class="memory-box">
                <h2 style="cursor: pointer;">Student Memory</h2>
                <ul class="sidebar-list">
                    <li><strong>Strengths</strong><span style="color: black;"> Mathematics, Problem solving</span></li>
                    <li><strong>Weaknesses</strong><span style="color: black;"> English grammar, Time management</span> </li>
                    <li><strong>Topics Covered</strong><span style="color: black;"> Basic arithmetic, Introductory algebra</span> </li>
                    <li><strong>Learning Style</strong><span style="color: black;"> Visual learner, Prefers hands-on exercises</span> </li>
                </ul>
            </div>
            <div data-intro="Progress of topics you are currently learning from TutorAI." data-step="8" class="progress-box">
                <h3 style="cursor: pointer;">Module Progress <i class="fas fa-angle-right"></i></h3>
                <div class="module" style="color: black;">
                    <p>Basic Algebra</p>
                    <div class="progress-bar">
                        <div class="progress" style="width: 75%;"></div>
                    </div>
                </div>
                <div class="module" style="color: black; margin-top: 6px;">
                    <p>English Grammar</p>
                    <div class="progress-bar">
                        <div class="progress" style="width: 40%;"></div>
                    </div>
                </div>
                <div class="module" style="color: black; margin-top: 6px;">
                    <p>MS Excel Basics</p>
                    <div class="progress-bar">
                        <div class="progress" style="width: 60%;"></div>
                    </div>
                </div>
            </div>

            <div data-intro="Shows your job credits unlocking progress. Find more about this in JobAI." data-step="9" class="progress-box">
                <h3 style="margin-bottom: 0px; cursor: pointer;">Next Job Unlock <i class="fas fa-angle-right"></i></h3>
                <p style="font-size: small; color: black;">Based on Module progress</p>
                
                <div class="module" style="color: black;">
                    <p style="margin-top: 7px;">Data Entry</p>
                    <div class="progress-bar">
                        <div class="progress" style="width: 55%;"></div>
                    </div>
                </div>
                <div class="module" style="color: black; margin-top: 6px;">
                    <p>Data Annotation</p>
                    <div class="progress-bar">
                        <div class="progress" style="width: 70%;"></div>
                    </div>
                </div>
                <div class="module" style="color: black; margin-top: 6px;">
                    <p>Content Writing</p>
                    <div class="progress-bar">
                        <div class="progress" style="width: 35%;"></div>
                    </div>
                </div>
            </div>
        </aside>
        <main class="chat-main">
            <header class="chat-header">
                <h2 data-intro="TutorAI is your personal digital teacher powered with vision capabilities and a comprehensive knowledge base." data-step="1" class="ai-switch" id="aiSwitch">
                    Tutor AI
                    <i class="fas fa-angle-down ai-switch-icon" style="margin-left: 3px;"></i>
                    <div class="ai-options" id="aiOptions">
                        <a href="#" id="jobAI">Job AI</a>
                        <a href="#" id="quizAI">Quiz AI</a>
                        <a href="#" id="Community">Community</a>
                        <a href="#" id="UserJourneyFlow">User Flow</a>
                    </div>
                </h2>

                <div data-intro="Select your language from multiple indic languages." data-step="2" class="language-menu">
                    <button class="language-btn" id="languageBtn" style="font-size: 2px; border-radius: 100px; display: flex; width: 60px; height: 30px; align-items: center; justify-content: center;"><i class="fas fa-language" style="font-size: 32px; color: #ffffff;"></i></button>
                    <div class="language-options" id="languageOptions">
                        <a href="#">English</a>
                        <a href="#">हिन्दी (Hindi)</a>
                        <a href="#">বাংলা (Bengali)</a>
                        <a href="#">తెలుగు (Telugu)</a>
                        <a href="#">मराठी (Marathi)</a>
                    </div>
                </div>
            </header>
            <div class="chat-messages" id="chatMessages">
                <div class="message ai-message">
                    <div class="ai-message-content">
                        <p>Hello! I'm your Tutor AI. How can I help you today?</p>
                        <div data-intro="Press this button to use text-to-speech." data-step="10" class="sound-icon-wrapper">
                            <i class="fas fa-volume-up"></i>
                        </div>
                    </div>
                    <br>
                    <p style="font-size: smaller;"><i><strong>(To generate a quiz or change the language, just ask me!)</strong></i></p>
                </div>
            </div>
            <div class="chat-input">
                <input data-intro="Type your message here." data-step="11" type="text" id="userInput" placeholder="Type your message here...">
                <button data-intro="and hit Send!" data-step="12" id="sendBtn"><i class="fas fa-paper-plane"></i></button>
                <button data-intro="Press this button to use voice input functionality." data-step="13" class="mic-button" id="micBtn"><i class="fas fa-microphone"></i></button>
                <button data-intro="Press this button to clear chat context." data-step="14" id="clearContextBtn"><i class="fas fa-broom"></i></button>
            </div>
        </main>
    </div>

    <script>
        const chatMessages = document.getElementById('chatMessages');
        const noou = document.getElementById('noou');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');
        const shareScreenBtn = document.getElementById('shareScreenBtn');
        const uploadFileBtn = document.getElementById('uploadFileBtn');
        const fileUpload = document.getElementById('fileUpload');
        const micBtn = document.getElementById('micBtn');
        const languageBtn = document.getElementById('languageBtn');
        const languageOptions = document.getElementById('languageOptions');
        const fileList = document.getElementById('fileList');
        const aiSwitch = document.getElementById('aiSwitch');
        const aiOptions = document.getElementById('aiOptions');
        const jobAI = document.getElementById('jobAI');
        const quizAI = document.getElementById('quizAI');
        const Community = document.getElementById('Community');
        const UserJourneyFlow = document.getElementById('UserJourneyFlow');
        const studentMemoryDiv = document.querySelector('.memory-box');
        const clearContextBtn = document.getElementById('clearContextBtn');

        const toggleCameraBtn = document.getElementById('toggleCameraBtn');
        const videoContainer = document.getElementById('videoContainer');
        const video = document.getElementById('video');
        const emotion1 = document.getElementById('emotion1');
        const emotion2 = document.getElementById('emotion2');

        let stream = null;
        let isCameraOn = false;

        const apiKey = 'YOUR_API_KEY';
        const apiSecret = 'YOUR_API_SECRET';
        const faceApiUrl = `https://api-us.faceplusplus.com/facepp/v3/detect`;

        toggleCameraBtn.addEventListener('click', () => {
            if (!isCameraOn) {
                navigator.mediaDevices.getUserMedia({ video: true })
                    .then(s => {
                        stream = s;
                        video.srcObject = stream;
                        videoContainer.style.display = 'block';
                        toggleCameraBtn.querySelector('span').textContent = 'Stop Camera';
                        isCameraOn = true;
                        processFrame();
                    })
                    .catch(err => {
                        console.error('Error accessing the camera:', err);
                    });
            } else {
                stopCamera();
            }
        });

        function stopCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                video.srcObject = null;
            }
            videoContainer.style.display = 'none';
            toggleCameraBtn.querySelector('span').textContent = 'Start Camera';
            isCameraOn = false;
        }

        function processFrame() {
            if (!isCameraOn) return;

            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const context = canvas.getContext('2d');
            context.drawImage(video, 0, 0, canvas.width, canvas.height);

            canvas.toBlob(blob => {
                const formData = new FormData();
                formData.append('api_key', apiKey);
                formData.append('api_secret', apiSecret);
                formData.append('image_file', blob);
                formData.append('return_attributes', 'emotion');

                fetch(faceApiUrl, {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.faces && data.faces.length > 0) {
                        const emotions = data.faces[0].attributes.emotion;
                        const sortedEmotions = Object.entries(emotions).sort((a, b) => b[1] - a[1]);
                        emotion1.textContent = `Emotion 1: ${sortedEmotions[0][0]}`;
                        emotion2.textContent = `Emotion 2: ${sortedEmotions[1][0]}`;
                    } else {
                        emotion1.textContent = 'Emotion 1: None';
                        emotion2.textContent = 'Emotion 2: None';
                    }
                    if (isCameraOn) setTimeout(processFrame, 1000);
                })
                .catch(err => {
                    console.error('Error detecting emotion:', err);
                });
            }, 'image/jpeg');
        }


                clearContextBtn.addEventListener('click', clearContext);

                async function clearContext() {
                try {
                    const response = await fetch('/api/clear_context', {
                        method: 'POST',
                    });
                    const data = await response.json();
                    chatMessages.innerHTML = '';
                    addMessage("Chat context cleared. You can start a new conversation.", 'system-message');
                    updateStudentMemory({
                        strengths: [],
                        weaknesses: [],
                        topics_covered: [],
                        learning_style: []
                    });
                } catch (error) {
                    console.error('Error:', error);
                    addMessage("An error occurred while clearing the chat context.", 'system-message');
                }
            }
    
        aiSwitch.addEventListener('click', function(event) {
            event.stopPropagation();
            this.classList.toggle('active');
            aiOptions.classList.toggle('show');
        });
    
        jobAI.addEventListener('click', function(event) {
            event.preventDefault();
            window.location.href = 'https://vocation-ai.web.app/JobAI.html';
        });
    
        quizAI.addEventListener('click', function(event) {
            event.preventDefault();
            window.location.href = 'https://vocation-ai.web.app/QuizAI.html';
        });
    
        Community.addEventListener('click', function(event) {
            event.preventDefault();
            window.location.href = 'https://vocation-ai.web.app/Community.html';
        });
    
        UserJourneyFlow.addEventListener('click', function(event) {
            event.preventDefault();
            window.location.href = 'https://vocation-ai.web.app/user-journey.html';
        });
    
        window.addEventListener('click', function(event) {
            if (!event.target.matches('.ai-switch')) {
                aiSwitch.classList.remove('active');
                aiOptions.classList.remove('show');
            }
        });
    
        sendBtn.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
    
        shareScreenBtn.addEventListener('click', async () => {
    try {
        const stream = await navigator.mediaDevices.getDisplayMedia({ video: true });

        const screenShareContainer = document.createElement('div');
        screenShareContainer.classList.add('sidebar-section1');

        const title = document.createElement('h3');
        title.innerText = 'Shared Screen';
        screenShareContainer.appendChild(title);

        const videoElement = document.createElement('video');
        videoElement.srcObject = stream;
        videoElement.autoplay = true;
        videoElement.muted = true;
        videoElement.classList.add('screen-share-video');

        screenShareContainer.appendChild(videoElement);

        const stopBtn = document.createElement('button');
        stopBtn.innerText = 'Stop Sharing';
        stopBtn.classList.add('stop-sharing-btn');

        stopBtn.addEventListener('click', () => {
            const tracks = stream.getTracks();
            tracks.forEach(track => track.stop());
            screenShareContainer.remove();
        });

        screenShareContainer.appendChild(stopBtn);

        const fileListContainer = document.querySelector('#fileList').parentNode;
        fileListContainer.parentNode.insertBefore(screenShareContainer, fileListContainer);

    } catch (error) {
        console.error('Error during screen sharing:', error);
        alert('Failed to start screen sharing.');
    }
});

    
        uploadFileBtn.addEventListener('click', () => {
            fileUpload.click();
        });
    
        fileUpload.addEventListener('change', (e) => {
            const files = e.target.files;
            if (files.length > 0) {
                let fileNames = Array.from(files).map(file => file.name);
                fileNames.forEach(fileName => {
                    const li = document.createElement('li');
                    li.textContent = fileName;
                    noou.innerHTML = "";
                    fileList.appendChild(li);
                });
                addMessage(`Uploaded files: ${fileNames.join(', ')}`, 'user-message');
            }
        });
    
        micBtn.addEventListener('click', () => {
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'en-US';
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    recognition.start();

    micBtn.classList.add('listening');
    micBtn.innerHTML = '<i class="fas fa-microphone"></i> Listening...';

    recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        userInput.value = transcript;
        micBtn.classList.remove('listening');
        micBtn.innerHTML = '<i class="fas fa-microphone"></i>';
    };

    recognition.onerror = (event) => {
        console.error('Speech recognition error:', event.error);
        alert('An error occurred with voice input. Please try again.');
        micBtn.classList.remove('listening');
        micBtn.innerHTML = '<i class="fas fa-microphone"></i>';
    };

    recognition.onend = () => {
        console.log('Speech recognition service disconnected');
        micBtn.classList.remove('listening');
        micBtn.innerHTML = '<i class="fas fa-microphone"></i>';
    };
});
    
        languageBtn.addEventListener('click', (event) => {
            event.stopPropagation();
            languageOptions.classList.toggle('show');
        });
    
        window.addEventListener('click', (event) => {
            if (!event.target.closest('.language-menu')) {
                languageOptions.classList.remove('show');
            }
        });
    
        sendBtn.addEventListener('click', sendMessage);
    userInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            sendMessage();
        }
    });

    async function sendMessage() {
        const message = userInput.value.trim();
        if (message) {
            addMessage(message, 'user-message');
            userInput.value = '';
            await getAIResponse(message);
        }
    }

    async function getAIResponse(message) {
    const skeletonLoader = addSkeletonLoader();
    
    try {
        const response = await fetch('/api/chat', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ message: message }),
        });
        const data = await response.json();
        chatMessages.removeChild(skeletonLoader);
        
        if (data.quiz_data) {
            localStorage.setItem('quizData', JSON.stringify(data.quiz_data));
            addMessage("Quiz generated successfully. Redirecting to quiz page...", 'ai-message');
            setTimeout(() => {
                window.location.href = '/quiz';
            }, 2000);
        } else {
            addMessage(formatMessage(data.message), 'ai-message');
            updateStudentMemory(data.student_memory);
        }
    } catch (error) {
        console.error('Error:', error);
        chatMessages.removeChild(skeletonLoader);
        addMessage("I'm sorry, I encountered an error while processing your request.", 'ai-message');
    }
}


function addMessage(message, className) {
    const messageElement = document.createElement('div');
    messageElement.classList.add('message', className);
    
    if (className === 'ai-message') {
        const contentDiv = document.createElement('div');
        contentDiv.classList.add('ai-message-content');
        
        contentDiv.innerHTML = `
            <p>${message}</p>
            <div class="sound-icon-wrapper">
                <i class="fas fa-volume-up"></i>
            </div>
        `;
        
        messageElement.appendChild(contentDiv);

        const references = document.createElement('div');
                references.classList.add('references');
                references.innerHTML = `
                    <p>References:</p>
                    <ul>
                        <li><a href="#" onclick="alert('This would link to a YouTube video in the knowledge base.')">YouTube: Introduction to the topic</a></li>
                        <li><a href="#" onclick="alert('This would link to an article in the knowledge base.')">Article: Detailed explanation</a></li>
                    </ul>
                `;
        
        messageElement.appendChild(references);
    } else {
        messageElement.innerHTML = `<p>${message}</p>`;
    }
    
    chatMessages.appendChild(messageElement);
    chatMessages.scrollTop = chatMessages.scrollHeight;

    const quizLink = messageElement.querySelector('.quiz-link');
    if (quizLink) {
        quizLink.addEventListener('click', (e) => {
            e.preventDefault();
            window.location.href = '/quiz';
        });
    }
}



    function formatMessage(message) {
        message = message.replace(/\n\n/g, '<br><br>');
        message = message.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        return message;
    }

    function updateStudentMemory(memory) {
        let memoryHTML = '<h2>Student Memory</h2><ul>';
        for (const [key, values] of Object.entries(memory)) {
            if (values.length > 0) {
                memoryHTML += `<li style="color: #830c4f"><strong>${key.replace('_', ' ')}:</strong> ${values.join(', ')}</li>`;
            }
        }
        memoryHTML += '</ul>';
        studentMemoryDiv.innerHTML = memoryHTML;
    }

    function addSkeletonLoader() {
        const skeletonLoader = document.createElement('div');
        skeletonLoader.classList.add('skeleton');
        chatMessages.appendChild(skeletonLoader);
        chatMessages.scrollTop = chatMessages.scrollHeight;
        return skeletonLoader;
    }
    
    document.addEventListener('DOMContentLoaded', () => {
    chatMessages.addEventListener('click', (event) => {
        const soundIconWrapper = event.target.closest('.sound-icon-wrapper');
        if (soundIconWrapper) {
            event.stopPropagation();
            const messageElement = soundIconWrapper.closest('.ai-message-content').querySelector('p');
            const textToSpeak = messageElement ? messageElement.innerText : '';

            if (typeof responsiveVoice !== 'undefined') {
                responsiveVoice.speak(textToSpeak, "UK English Female", { 
                    rate: 1, 
                    pitch: 1, 
                    volume: 1 
                });
            } else {
                alert('Text-to-Speech functionality is not available.');
            }
        }
    });
});


    
        document.addEventListener('DOMContentLoaded', function () {
            const elements = document.querySelectorAll('.highlight');
            const steps = Array.from(elements).map((element, index) => ({
                element: element,
                intro: element.getAttribute('data-intro'),
                position: 'right'
            }));
    
            introJs().setOptions({
                steps: steps,
                showSkipButton: true
            }).start();
        });
    </script>
    <style>
        .card-container {
    border: 1px solid #ccc;
    border-radius: 4px;
    padding: 10px;
    margin-bottom: 15px;
    background-color: #f8f9fa;
}

.card-container h3 {
    color: #830c4f;
    margin-bottom: 8px;
}

.screen-share-video {
    width: 100%;
    height: auto;
    border-radius: 4px;
    margin-bottom: 10px;
}

.stop-sharing-btn {
    width: 100%;
    padding: 8px;
    background-color: #830c4f;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

.stop-sharing-btn:hover {
    background-color: #6b0a40;
}

    </style>
</body>
</html>